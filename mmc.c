#include <stdlib.h>
#include <string.h>
#include <nes.h>
#include "neslib.h"

#define NES_MAPPER 4
#define NES_PRG_BANKS 4
#define NES_CHR_BANKS 0

const char TILESET[256] = {
0x0,0x3C,0x3E,0x1F,0x1F,0xF,0xF,0x7,
0x0,0x38,0x3B,0x3B,0x1B,0x19,0x2,0xF,
0x0,0x0,0x0,0x0,0xC0,0xE0,0xF0,0xF8,
0x0,0x0,0x0,0x80,0xC0,0xA0,0x30,0xC8,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7,
0x0,0x0,0x0,0x0,0x2,0x0,0x0,0x4,
0x0,0x0,0x1,0x3,0x7,0xE,0x12,0x34,
0x3,0x1,0x0,0x70,0x18,0x6,0x1,0x0,
0x7,0x2,0x1,0x78,0x1F,0x7,0x1,0x0,
0xFC,0xFE,0xFF,0x3F,0x7,0x1,0xC0,0x6C,
0xDC,0x1C,0xED,0x71,0x1E,0xC6,0xF0,0x70,
0x0,0x0,0x0,0x80,0x80,0xA,0x6,0x1C,
0x0,0x0,0x1,0x83,0xC1,0xE0,0xC0,0x0,
0xA2,0x4A,0x52,0x24,0x24,0x28,0x54,0x38,
0xB2,0x5A,0x52,0xA4,0xA4,0x28,0x80,0x44,
0x0,0x0,0x0,0x0,0x0,0x1,0x4,0x0,
0x0,0x0,0x0,0x1,0x7,0x1E,0x78,0x0,
0x0,0x1D,0x12,0x2A,0x4A,0xAB,0x2D,0x26,
0x0,0x0,0x62,0xC2,0x82,0x23,0x21,0x20,
0xD9,0xBB,0x8B,0x89,0xC,0x7,0x0,0x0,
0x1,0x3,0x3,0x21,0x20,0x60,0x60,0x63,
0xBA,0x5B,0x5A,0x5A,0xDC,0x18,0x24,0x14,
0x82,0x43,0x42,0x42,0xC0,0x0,0x24,0x14,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
0x59,0x6E,0x70,0x38,0x10,0x20,0x20,0x20,
0x18,0xE,0x0,0x0,0x0,0x0,0x20,0x20,
0x80,0x0,0x0,0x0,0x0,0x0,0x0,0x9,
0x3,0x21,0x30,0x10,0x9,0x8,0x19,0x9,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
0x80,0x0,0x80,0x80,0x80,0x80,0x0,0x0
};

//Tile set 2
const char TILESET2[256] = {
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
0x0,0x8,0xF,0x7,0x5,0x3,0x2,0x2,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
0x0,0x7C,0xFF,0xFF,0xFF,0xFF,0x7E,0x3C,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x81,
0x0,0x0,0x88,0x18,0x78,0xB0,0x3,0x4,
0x0,0x8,0x10,0x60,0x0,0x0,0x0,0xF0,
0x0,0x0,0x0,0x1,0x0,0x0,0x2,0x1,
0x0,0x0,0x0,0x0,0x0,0xE,0x18,0x1,
0x12,0x12,0x31,0x35,0x74,0xEE,0xCE,0x83,
0x10,0x10,0x30,0xB0,0x70,0xE0,0xD0,0x9C,
0x88,0xC1,0x71,0x70,0x3,0x82,0x34,0x44,
0x42,0x35,0x5,0x4,0x88,0x79,0x2,0x2,
0xE,0x31,0x10,0xC8,0x0,0x0,0x10,0x28,
0x0,0x0,0x0,0xD0,0x18,0xFC,0xCC,0x24,
0x1,0x1,0x0,0x22,0x6,0x0,0x0,0x0,
0x1D,0x75,0x54,0x48,0x20,0x0,0x0,0x0,
0x0,0x80,0x6,0x3,0x9,0x36,0x73,0xC,
0x7,0x80,0x0,0x0,0x8,0x6,0x83,0x70,
0x70,0xFA,0xFB,0x4,0xF0,0x4,0x88,0x2,
0x1,0x0,0x0,0x2,0x0,0x4,0xB8,0x30,
0x0,0x80,0x0,0x60,0xC0,0x80,0x88,0x0,
0x80,0x70,0x0,0x0,0x20,0x47,0x41,0x77,
0x2,0x3,0x7,0x5,0xC,0xC,0xC,0x6,
0x2,0x3,0x7,0x5,0xC,0xC,0xC,0x6,
0x0,0x81,0x4F,0x6E,0x3C,0x10,0x0,0x0,
0xE,0x80,0x0,0x1,0x2,0x8,0x0,0x0,
0x0,0x9C,0x7,0x23,0x16,0x18,0xC,0x0,
0x3,0x0,0x0,0x20,0x11,0x18,0xC,0x0,
0x8,0x5,0x0,0x0,0x0,0x0,0x0,0x0,
0x21,0x2,0x80,0x80,0x0,0x0,0x0,0x0
};

/*{pal:"nes",layout:"nes"}*/
const char PALETTE[32] = { 
  0x0D,			// screen color

  0x11,0x30,0x27,0x0,	// background palette 0
  0x1c,0x20,0x2c,0x0,	// background palette 1
  0x00,0x10,0x20,0x0,	// background palette 2
  0x06,0x16,0x26,0x0,   // background palette 3

  0x16,0x35,0x24,0x0,	// sprite palette 0
  0x00,0x37,0x25,0x0,	// sprite palette 1
  0x0d,0x2d,0x3a,0x0,	// sprite palette 2
  0x0d,0x27,0x2a	// sprite palette 3
};

// setup PPU and tables
void setup_graphics() {
  pal_all(PALETTE);
  
  vram_adr(0x00);
  vram_write(TILESET2,sizeof(TILESET2));
  vram_adr(0x100);
  vram_write(TILESET,sizeof(TILESET));

}

void main(void)
{
  int i,j,x,y;
  int num;
  x = 0; y = 1;
  setup_graphics();
  // copy background tiles
  num=0;
  for(j=0;j<4;j++){
  for(i=0;i<4;i++){
      vram_adr(NTADR_A(x+i,y+j));
      vram_put(num);
      num = num +1;
  }
  }
  
  num=0;
  x=7;y=2;
  for(j=0;j<4;j++){
  for(i=0;i<4;i++){
      vram_adr(NTADR_A(x+i,y+j));
      vram_put(num);
      num = num +1;
  }
  }
  
  num = 16;
  x=12;y=2;
  for(j=0;j<4;j++){
  for(i=0;i<4;i++){
      vram_adr(NTADR_A(x+i,y+j));
      vram_put(num);
      num = num +1;
  }
  }
  
  // draw message  
 
  // enable rendering
  ppu_on_all();
  // infinite loop
  while(1) {
  }
}
